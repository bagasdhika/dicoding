const CACHE_NAME="dicoding-story-v5",STATIC_ASSETS=["/","/index.html"];self.addEventListener("install",(t=>{console.log("[SW] Installing..."),t.waitUntil(caches.open(CACHE_NAME).then((async t=>{for(const e of STATIC_ASSETS)try{const n=await fetch(e);n&&n.ok&&await t.put(e,n.clone())}catch(t){console.log("[SW] Skip cache:",e)}}))),self.skipWaiting()})),self.addEventListener("activate",(t=>{console.log("[SW] Activated"),t.waitUntil(caches.keys().then((t=>Promise.all(t.filter((t=>t!==CACHE_NAME)).map((t=>caches.delete(t))))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{const{request:e}=t;"GET"===e.method&&(e.url.includes("story-api.dicoding.dev")?t.respondWith(fetch(e).then((t=>{if(!t||200!==t.status)return t;const n=t.clone();return caches.open(CACHE_NAME).then((t=>{t.put(e,n)})),t})).catch((()=>caches.match(e)))):t.respondWith(caches.match(e).then((t=>t||fetch(e)))))})),self.addEventListener("push",(t=>{console.log("[SW] Push Received");let e="Dicoding Story",n="Story baru telah ditambahkan",i="/";if(t.data)try{try{const c=t.data.json();e=c.title||e,n=c.body||c.description||n,i=c.url||i}catch{n=t.data.text()}}catch(t){console.error("[SW] Push parse error",t)}t.waitUntil(self.registration.showNotification(e,{body:n,icon:"/icons/icon-192.png",badge:"/icons/icon-72.png",data:{url:i}}))})),self.addEventListener("notificationclick",(t=>{t.notification.close();const e=t.notification?.data?.url||"/";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const n of t)if(n.url.includes(e)&&"focus"in n)return n.focus();if(clients.openWindow)return clients.openWindow(e)})))}));